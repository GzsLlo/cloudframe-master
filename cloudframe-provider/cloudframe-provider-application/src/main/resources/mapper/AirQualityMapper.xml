<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ai.cloudframe.provider.application.mapper.AirQualityMapper">

  <select id="getDeviceData" resultType="com.ai.cloudframe.provider.api.sys.model.vo.AirQualityVo"
          parameterType="Map">
    SELECT
      taaq.AIR_ID,
      taaq.DEVICE_ID,
      taaq.CITY_CODE,
      taaq.AREA_CODE,
      taaq.AREA_NAME,
      taaq.COLLECT_DATE,
      taaq.PM,
			tac.CITY_NAME
    FROM
      tf_asiainfo_air_quality taaq
		LEFT JOIN
			tf_asiainfo_city tac on taaq.CITY_CODE = tac.CITY_CODE
		WHERE
		  1 = 1
    <if test="param.cityCode != null and param.cityCode != ''">
      AND taaq.CITY_CODE = #{param.cityCode}
    </if>
  </select>

  <select id="getAirQualityByTime" resultType="com.ai.cloudframe.provider.api.sys.model.vo.AirQualityVo"
          parameterType="Map">
    SELECT
      taaq.AIR_ID,
      taaq.DEVICE_ID,
      taaq.CITY_CODE,
      taaq.AREA_CODE,
      taaq.AREA_NAME,
      taaq.COLLECT_DATE,
      taaq.PM,
      tac.CITY_NAME
    FROM
      tf_asiainfo_air_quality taaq
    LEFT JOIN
      tf_asiainfo_city tac on taaq.CITY_CODE = tac.CITY_CODE
    WHERE
      1 = 1
      <if test="param.PM != null and param.PM != '' and param.thresholdType == 0">
        AND to_number(taaq.PM) &gt;= to_number(#{param.PM})
      </if>
      <if test="param.PM != null and param.PM != '' and param.thresholdType == 1">
        AND to_number(taaq.PM) &lt;= to_number(#{param.PM})
      </if>
      <if test="param.startTime != null and param.endTime != null">
        AND (TO_CHAR(taaq.COLLECT_DATE,'hh24:mi:ss') &gt; TO_CHAR(#{param.startTime},'hh24:mi:ss')
        AND TO_CHAR(taaq.COLLECT_DATE,'hh24:mi:ss') &lt; TO_CHAR(#{param.endTime},'hh24:mi:ss'))
      </if>
      <if test="param.cityCode != null and param.cityCode != ''">
        AND taaq.CITY_CODE = #{param.cityCode}
      </if>
      <if test="param.areaCode != null and param.areaCode != ''">
        AND taaq.AREA_CODE = #{param.areaCode}
      </if>
  </select>

  <select id="getAirQualityByArea" resultType="com.ai.cloudframe.provider.api.sys.model.vo.AirQualityVo"
          parameterType="Map">
    SELECT
      taaq.AIR_ID,
      taaq.DEVICE_ID,
      taaq.CITY_CODE,
      taaq.AREA_CODE,
      taaq.AREA_NAME,
      taaq.COLLECT_DATE,
      taaq.PM,
      tac.CITY_NAME
    FROM
      tf_asiainfo_air_quality taaq
    LEFT JOIN
      tf_asiainfo_city tac on taaq.CITY_CODE = tac.CITY_CODE
    WHERE
      1 = 1
      <if test="param.PM != null and param.PM != '' and param.thresholdType == 0">
        AND to_number(taaq.PM) &gt;= to_number(#{param.PM})
      </if>
      <if test="param.PM != null and param.PM != '' and param.thresholdType == 1">
        AND to_number(taaq.PM) &lt;= to_number(#{param.PM})
      </if>
      <if test="param.regions != null and param.regions.size > 0">
        AND (CONCAT(taaq.CITY_CODE,taaq.AREA_CODE) IN
        <foreach item="item" index="index" collection="param.regions" open="(" separator="," close=")">
          #{item}
        </foreach>
        OR taaq.CITY_CODE IN
        <foreach item="item" index="index" collection="param.regions" open="(" separator="," close=")">
          #{item}
        </foreach>)
      </if>
      <if test="param.cityCode != null and param.cityCode != ''">
        AND taaq.CITY_CODE = #{param.cityCode}
      </if>
      <if test="param.areaCode != null and param.areaCode != ''">
        AND taaq.AREA_CODE = #{param.areaCode}
      </if>
  </select>

</mapper>
